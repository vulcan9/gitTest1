var express = require('express')
, http = require('http')
, fs = require('fs');

var server = http.createServer(handler)
, io = require('socket.io').listen(server)


var app = express();
server.listen(80);


function handler(req, res)
{
	console.log('server ok');
	
	// 파일 읽기
	fs.readFile(
		__dirname + '/index.html',
		function (err, data)
		{
			if(err){
				res.writeHead(500);
				return res.end('Error loading index.html');
			}
			
			// 브라우져 출력
			res.writeHead(200, {'Content-Type':'text/html'});
			res.end(data);
			//res.end("<h1>Hello node.js---<h1>");
		}
	);
}

// socket 이 아니라 sockets 임에 주의
io.sockets.on(
		'connection',
		function(socket)
		{
			// 'news' 메세지 발송
			socket.emit(
					'news',
					{hello:'world'}
				);
			
			// 메세지 수신
			socket.on(
					'my other event',
					function (data)
					{
						console.log('server : ', data);
					}
				);
			
			/*
			//console.log('server : ', socket);
			socket.broadcast.emit(
					'user connect',
					{broadcast:'message'}
				);
			*/
		}
	);
